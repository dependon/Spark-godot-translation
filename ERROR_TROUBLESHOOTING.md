# 错误排查指南

本文档解释了用户可能遇到的常见错误及其解决方案。

## 1. Chrome扩展错误

### 错误信息
```
Unchecked runtime.lastError: The message port closed before a response was received.
Unchecked runtime.lastError: Could not establish connection. Receiving end does not exist.
```

### 原因分析
这些错误来自浏览器扩展程序，与我们的翻译应用无关。通常是由于：
- Chrome扩展程序试图与页面通信但连接失败
- 扩展程序在页面加载过程中尝试注入脚本
- 某些广告拦截器或安全扩展的正常行为

### 解决方案
1. **忽略这些错误** - 它们不影响翻译功能的正常使用
2. **禁用不必要的扩展** - 临时禁用可能干扰的浏览器扩展
3. **使用无痕模式** - 在无痕窗口中打开应用，避免扩展干扰
4. **清除浏览器缓存** - 清除浏览器缓存和Cookie

## 2. API请求错误

### 错误信息
```
/api/cache/stats/session_xxx:1 Failed to load resource: the server responded with a status of 400 ()
```

### 原因分析
- 在Socket.IO会话建立之前就尝试调用缓存统计API
- sessionId尚未正确初始化

### 解决方案
已在代码中修复：
- 添加了会话状态检查
- 在会话建立前禁用相关按钮
- 改善了错误提示信息

## 3. 翻译请求超时错误

### 错误信息
```
/api/translate:1 Failed to load resource: the server responded with a status of 524 ()
```

### 原因分析
- 524错误通常表示网关超时
- 翻译请求处理时间过长
- 网络连接不稳定

### 解决方案
已在代码中修复：
- 增加了请求超时时间（5分钟）
- 添加了超时错误的特殊处理
- 改善了错误提示信息

### 用户操作建议
1. **检查网络连接** - 确保网络连接稳定
2. **减少翻译内容** - 如果文件过大，可以分批处理
3. **重试操作** - 网络问题通常是临时的，可以重试
4. **检查API配置** - 确保百度翻译API配置正确

## 4. 会话管理优化

### 新增功能
- **按钮状态管理** - 会话建立前禁用缓存相关按钮
- **实时状态显示** - 显示当前会话连接状态
- **错误分类处理** - 区分不同类型的错误并给出相应提示

### 用户体验改进
- 更清晰的错误提示
- 更好的按钮状态反馈
- 更稳定的会话管理

## 5. 常见问题解答

### Q: 为什么会出现这么多Chrome扩展错误？
A: 这是浏览器扩展的正常行为，不影响应用功能。可以通过开发者工具的Console面板过滤这些消息。

### Q: 翻译请求为什么会超时？
A: 可能是网络问题或翻译内容过多。建议检查网络连接，或者分批处理大文件。

### Q: 如何避免这些错误？
A: 大部分错误已经通过代码优化解决。用户只需要等待页面完全加载，确保看到"会话ID已分配"的消息后再进行操作。

## 6. 技术改进说明

### 错误处理优化
- 添加了请求超时控制
- 改善了HTTP状态码检查
- 增强了错误日志记录

### 用户界面优化
- 按钮状态动态管理
- 更友好的错误提示
- 会话状态实时显示

### 稳定性提升
- Socket.IO连接状态监控
- 会话生命周期管理
- 错误恢复机制